# CanaryGAN

**Pytorch reimplementation of Pagliarini et al. (2021) "What does the Canary Say? Low-Dimensional GAN Applied to Birdsong"**


## Installation

First, clone the repository on your computer.

We recommend using a virtual environment when using this tool. You may use `virtualenv` or `pyenv` for instance. If using `conda`, pay attention when 
performing the next steps, as some package requirements may differ.

Code should run with `python>=3.9<=3.11`.

### Using pip (recommended)

After cloning the repository and creating a virtual environment, open a terminal and place yourself at the repository root. Activate your virtual environment 
(this step may differ from one virtual environment manager to another).

Now, run:

```bash
pip install -e .
```
This will install `canarygan` along with its dependencies, and add `canarygan` to your `PATH`. You will now be able
to use `canarygan` command line interface.

### Manually from requirements

In some cases, you might want to install requirements manually. **This is required if you need a specific version of Pytorch to run on your machine**.
Package requirements may be found in the `requirements.txt` file, and in the `pyproject.toml` file.

You can install requirements by running the following command within the repository and a virtual environment:

```bash
pip install -r requirements.txt
```

Modify this file, or use `pip` or `conda` is you wish to install packages differently.

You may still try to run `pip install -e .` after this step to add `canarygan` to your `PATH`. **If it does not work, replace all
following invocation of `canarygan` command line interface by `python -m canarygan`.

### Note on Pytorch

We let `torch` package requirement pretty lose on purpose, but can not ensure this tool will work on any machine and operating system.

This tool was developped using Pytorch 2.0.3, and run on different Linux operating systems, equipped with different hardware. It worked
using Nvidia GPUs (Quadro 4000TX, P100, A100) with CUDA 11.8.


## Command line interface (CLI)

`canarygan` provides a CLI to perform major operations, such as training the GAN and generating sounds.

You can display a short description of the interface by running:

```bash
canarygan --help
```

**Note: if you installed `canarygan` manually, you may have to type `python -m canarygan --help` instead.**


## Dataset

Two datasets are required: one to train the GAN and the other to train the decoders.

Both datasets must be WAV files containing 1 second of audio, sampled at 16000Hz at least. If the sampling rate is higher, it will be reduced to 16000Hz automatically.
These 1 second of audio must hold a unique birdsong syllable rendition. Original results were obtained over a dataset of 16 different types of syllables, sampled from 
a single canary individual.

Audio files must be organized in folders named after the canary syllable labels. We recommend that each folder contain the same number of audio samples. In the original
paper, 1000 samples per type of syllable were used to train the GAN and the decoders.

Dataset structure hence resembles this:

```
data_dir/
    |
    |- label_1/
    |   |- ...
    |- label_2/
    |   |- ...
    ...
    |- label_n/
        |- audio_1.wav
        |- audio_2.wav
        |- audio_3.wav
        ...
        |- audio_m.wav
```

**GAN dataset**: GAN training dataset must contain real samples only.

**Decoder dataset**: Decoder training dataset must include GAN training dataset, and append GAN generated songs. In original work, 5 classes of audio were
added: audio samples generated by the GAN at training epoch 15, 30, 45 and last epoch, and white noise samples. These samples were labeled "EARLY15", "EARLY30", 
"EARLY45", "OT" (**O**ver **T**raining"), and "WN" (**W**hite **N**oise). They may also sometimes be refered to alltogether as the "X" class.

## Training the GAN

GAN training loop was implemented using Lightning. Lightning allows from distributed training strategies, using multiple GPUs on multiple compute nodes.
However, this training loop should also work locally on a modern powerful computer.

From your terminal, run:
```bash
canarygan 
```
